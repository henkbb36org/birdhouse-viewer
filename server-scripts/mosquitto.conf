# Mosquitto MQTT Broker Configuration for Birdhouse Viewer
# 
# This configuration enables:
# - Standard MQTT on port 1883
# - WebSocket support on port 8080 for browser clients
# - Anonymous connections (for development - use authentication in production)
# - Logging for debugging
#
# Installation:
#   Ubuntu/Debian: sudo apt-get install mosquitto
#   macOS: brew install mosquitto
#
# Usage:
#   mosquitto -c mosquitto.conf
#
# For production, enable authentication:
#   1. Create password file: mosquitto_passwd -c /etc/mosquitto/passwd username
#   2. Uncomment authentication settings below
#   3. Set allow_anonymous false

# ============================================================================
# LISTENERS
# ============================================================================

# Standard MQTT listener on port 1883
listener 1883
protocol mqtt

# WebSocket listener on port 8080 for browser clients (PWA)
listener 8080
protocol websockets

# ============================================================================
# AUTHENTICATION (Uncomment for production)
# ============================================================================

# Allow anonymous connections (DEVELOPMENT ONLY)
# In production, set this to false and configure password file
allow_anonymous true

# Password file for authentication (uncomment for production)
# password_file /etc/mosquitto/passwd

# ============================================================================
# PERSISTENCE
# ============================================================================

# Enable message persistence
persistence true
persistence_location /var/lib/mosquitto/

# Autosave interval (seconds)
autosave_interval 1800

# ============================================================================
# LOGGING
# ============================================================================

# Log to file and console
log_dest file /var/log/mosquitto/mosquitto.log
log_dest stdout

# Log types
log_type error
log_type warning
log_type notice
log_type information

# Connection messages for debugging
connection_messages true

# Log timestamp
log_timestamp true

# Log timestamp format
log_timestamp_format %Y-%m-%d %H:%M:%S

# ============================================================================
# LIMITS
# ============================================================================

# Maximum number of client connections
max_connections -1

# Maximum QoS level (0, 1, or 2)
max_qos 2

# Maximum number of messages to hold in queue per client
max_queued_messages 1000

# Maximum payload size (bytes) - increased for image streaming
message_size_limit 10485760

# ============================================================================
# SECURITY
# ============================================================================

# Require protocol version 3.1.1 or higher
protocol_version mqttv311

# ============================================================================
# WEBSOCKET SETTINGS
# ============================================================================

# WebSocket protocol name
websockets_log_level 255

# ============================================================================
# BRIDGE (Optional - for cloud MQTT broker integration)
# ============================================================================

# Uncomment to bridge to a cloud MQTT broker
# connection bridge-to-cloud
# address cloud-broker.example.com:1883
# topic birdhouse/# both 0
# bridge_attempt_unsubscribe true
# bridge_protocol_version mqttv311
# cleansession true
